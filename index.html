<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cesium SAFE MODE — SITARLAUT 3D</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cesium@1.120/Build/Cesium/Widgets/widgets.css"/>
<style>
  html,body,#map{height:100%;margin:0;background:#0b1220}
  #status{
    position:fixed;left:12px;bottom:12px;z-index:10;
    background:#0b1220cc;color:#e6eef9;border:1px solid #20324d;border-radius:10px;
    padding:8px 10px;font:13px/1.4 system-ui,Segoe UI,Roboto,Arial
  }
  #toolbar{position:fixed;left:12px;top:12px;z-index:10;display:flex;gap:8px}
  button{background:#1e90ff;color:white;border:0;border-radius:8px;padding:8px 10px;font-weight:700;cursor:pointer}
</style>
</head>
<body>
<div id="map"></div>
<div id="toolbar">
  <button id="flyJakarta">Fly to Jakarta</button>
</div>
<div id="status">Status: memuat…</div>

<!-- Muat Cesium dari CDN. Jika ini diblok, coba ganti ke unpkg: https://unpkg.com/cesium@1.120/Build/Cesium/Cesium.js -->
<script src="https://cdn.jsdelivr.net/npm/cesium@1.120/Build/Cesium/Cesium.js"></script>
<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const setStatus = (t)=>{ $('status').textContent = 'Status: ' + t; console.log('[SAFE]', t); };

  // Cek WebGL
  function webglOk(){
    try{
      const c = document.createElement('canvas');
      return !!(window.WebGLRenderingContext && (c.getContext('webgl') || c.getContext('experimental-webgl')));
    }catch{ return false; }
  }
  if (!webglOk()){
    setStatus('WebGL tidak tersedia. Coba Chrome/Edge terbaru, aktifkan GPU acceleration.');
    return;
  }

  // === SAFE MODE: tanpa terrain Ion, tanpa Bing. Pakai OSM raster + EllipsoidTerrain ===
  let viewer;
  try{
    viewer = new Cesium.Viewer('map', {
      animation:false, timeline:false, geocoder:false, baseLayerPicker:false, sceneModePicker:true,
      terrain: new Cesium.EllipsoidTerrain(), // aman
      infoBox:true, selectionIndicator:true
    });
  }catch(e){
    setStatus('Gagal membuat Cesium Viewer: ' + e.message);
    alert('Cesium gagal inisialisasi. Cek Console (F12) & pastikan lewat http:// bukan file://');
    return;
  }

  // Ganti basemap default → OSM raster (tanpa token)
  try{
    const il = viewer.imageryLayers;
    while (il.length) il.remove(il.get(0), true);
    const prov = new Cesium.UrlTemplateImageryProvider({
      url: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
      credit: '© OpenStreetMap contributors',
      minimumLevel: 0, maximumLevel: 19
    });
    il.addImageryProvider(prov);
  }catch(e){
    console.warn('Gagal set OSM basemap:', e);
  }

  // Kamera awal + titik uji
  viewer.camera.setView({ destination: Cesium.Cartesian3.fromDegrees(117, -2, 5_000_000) });
  viewer.entities.add({
    position: Cesium.Cartesian3.fromDegrees(106.845, -6.2146, 0),
    point: { pixelSize: 10, color: Cesium.Color.CYAN },
    description: 'Titik uji: Jakarta'
  });

  // Tombol uji
  $('flyJakarta').onclick = ()=>{
    viewer.camera.flyTo({ destination: Cesium.Cartesian3.fromDegrees(106.827, -6.175, 2000), duration: 1.6 });
  };

  setStatus('SAFE MODE aktif (OSM raster + Ellipsoid). Jika ini muncul, Cesium Anda OK.');
})();
</script>
</body>
</html>
